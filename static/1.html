<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Vertically centers the form */
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            overflow-y: auto;
        }

        h2 {
            text-align: center;
        }

        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            margin: auto;
            /* Centers the form horizontally */
        }

        form label {
            margin-left: 8px;
            font-size: 15px;
            font-weight: bold;
        }

        form select,
        form input[type="text"],
        form input[type="file"],
        form input[type="submit"] {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }

        form input[type="submit"] {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        form input[type="submit"]:hover {
            background-color: #45a049;
        }

        .task {
            margin-bottom: 8px;
        }

        .task label {
            margin-left: 8px;
            font-weight: normal;
        }

        .required::after {
            content: " *";
            color: red;
        }

        /* Responsive Styling */
        @media (max-width: 768px) {
            form {
                padding: 15px;
                max-width: 100%;
                /* Full width on smaller screens */
                box-shadow: none;
            }

            form input[type="submit"],
            form input[type="text"],
            form input[type="file"],
            form select {
                font-size: 14px;
                padding: 8px;
            }

            h2 {
                font-size: 20px;
            }

            form label {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            form {
                padding: 10px;
            }

            form input[type="submit"],
            form input[type="text"],
            form input[type="file"],
            form select {
                font-size: 12px;
                padding: 6px;
            }

            h2 {
                font-size: 18px;
            }

            form label {
                font-size: 12px;
            }
        }
    </style>
</head>

<body>
    <form action="/submit" method="post" enctype="multipart/form-data" id="UploadForm">
        <h2>CONTENTS </h2>
        <label for="board" class="required">Board</label>
        <select id="board" name="board" required>
            <option value="">Select</option>
        </select>

        <label for="medium">Medium</label>
        <select id="medium" name="medium">
            <option value="select">Select</option>

        </select>

        <label for="grade" class="required">Class</label>
        <select id="grade" name="grade" required>
            <option value="select">Select</option>
        </select>

        <label for="subject" class="required">Subject</label>
        <select id="subject" name="subject" required>
            <option value="">Select</option>

        </select>

        <label for="lesson">Chapter/Topic</label>
        <select id="lesson" name="lesson">
            <option value="">Select</option>
        </select>

        <label for="task" class="required">Select the Question Type</label></br>
        <div class="task">
            <input type="checkbox" id="Fills_ups" name="tasks" value="fill-in-the-blanks">
            <label for="Fills_ups">Fill in the Blanks</label>
        </div>
        <div class="task">
            <input type="checkbox" id="name-the-following" name="tasks" value="name-the-following">
            <label for="name-the-following">Name the Following</label>
        </div>
        <div class="task">
            <input type="checkbox" id="match-the-column" name="tasks" value="match-the-column">
            <label for="match-the-column">Match the Column</label>
        </div>
        <div class="task">
            <input type="checkbox" id="give-reasons" name="tasks" value="give-scientific-reasons">
            <label for="give-reasons">Give Reasons</label>
        </div>
        <div class="task">
            <input type="checkbox" id="ans-one-word" name="tasks" value="answer-in-one-word">
            <label for="ans-one-word">Answers in One Word</label>
        </div>
        <div class="task">
            <input type="checkbox" id="multiple-choice" name="tasks" value="multiple-choice-questions">
            <label for="multiple-choice">Multiple Choice Questions</label>
        </div>
        <div class="task">
            <input type="checkbox" id="true-false" name="tasks" value="true-false">
            <label for="true-false">True/False</label>
        </div>
        <div class="task">
            <input type="checkbox" id="short-answers" name="tasks" value="short-answers">
            <label for="short-answers">Short Answers</label>
        </div>
        <div class="task">
            <input type="checkbox" id="long-answers" name="tasks" value="long-answers">
            <label for="long-answers">Long Answers</label>
        </div>
        <div class="task">
            <input type="checkbox" id="text-book-solution" name="tasks" value="text-book-solution"
                onclick="toggleCheckboxes(this)">
            <label for="text-book-solution">Text Book Solution</label>
        </div>

        <div class="task">
            <input type="checkbox" id="sample-paper-solution" name="tasks" value="sample-paper-solution"
                   onclick="toggleSamplePaper(this)">
            <label for="sample-paper-solution">Sample Paper</label>
        
            <div id="input-container" style="margin-top: 10px; display: none; margin-left:20px;">
                <select id="prev_years" name="prev_years" style="width:150px; height:30px; padding:0px; font-size:15px; margin-right: 10px;">
                    <option value="">Select Year</option>
                    <!-- Use JavaScript to populate the last 6 years -->
                </select>
        
                <input type="number" id="set_number" name="set_number" value="" style="width:130px; height:30px; display:inline-block;" placeholder="set number">
            </div>
        </div>
        


        <label for="file">Upload File:</label>
        <input type="file" id="file" name="file" accept=".doc,.pdf" required>

       

        <input type="submit" value="Submit" >
    </form>
</body>

<script>

    // Get the current year
    const currentYear = new Date().getFullYear();
    const prev_years = document.getElementById('prev_years');

    // Populate the dropdown with the last 6 years
    for (let i = 0; i < 6; i++) {
        const yearOption = document.createElement('option');
        yearOption.value = currentYear - i;
        yearOption.text = currentYear - i;
        prev_years.add(yearOption);
    }
    // Function to handle board selection change and manage medium disabling
    function handleBoardChange() {
        const boardSelect = document.getElementById('board');
        const mediumSelect = document.getElementById('medium');
        const gradeSelect = document.getElementById('grade');

        // Disable medium select if IB or CB is selected
        if (boardSelect.value === '2' || boardSelect.value === '3') {
            mediumSelect.disabled = true;
            mediumSelect.value = ''; // Reset medium select
            gradeSelect.disabled = false; // Enable class selection if board is selected
        } else {
            mediumSelect.disabled = false;
            gradeSelect.disabled = false; // Enable class selection once board is selected
        }
    }

    // Function to toggle checkboxes (if needed in the future)
    function toggleCheckboxes(mainCheckbox) {
        const otherCheckboxes = document.querySelectorAll('input[type="checkbox"]:not(#text-book-solution)');
        if (mainCheckbox.checked) {
            otherCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.disabled = true;
            });
        } else {
            otherCheckboxes.forEach(checkbox => checkbox.disabled = false);
        }
    }

    // Function to toggle checkboxes (if needed in the future)
    function toggleSamplePaper(mainCheckbox) {
        const otherCheckboxes1 = document.querySelectorAll('input[type="checkbox"]:not(#sample-paper-solution)');
        const inputContainer = document.getElementById('input-container');
        if (mainCheckbox.checked) {
            otherCheckboxes1.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.disabled = true;
            });
            inputContainer.style.display = 'block'; 
        } else {
            otherCheckboxes1.forEach(checkbox => checkbox.disabled = false);
            inputContainer.style.display = 'none'; 
        }
        
    }
    // Function to fetch and populate boards
    function fetchBoards() {
        fetch('/get_SchoolBoard')
            .then(response => response.json())
            .then(boards => {
                const boardInput = document.getElementById('board');
                boardInput.innerHTML = '<option value="">Select Board</option>';

                // Populate the board dropdown
                boards.forEach(boardItem => {
                    const option = document.createElement('option');
                    option.value = boardItem.board_id;
                    option.textContent = boardItem.board_name;
                    boardInput.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching boards:', error));
    }

    // Function to fetch and populate mediums
    function fetchMediums() {
        fetch('/get_SchoolMedium')
            .then(response => response.json())
            .then(mediums => {
                const mediumInput = document.getElementById('medium');
                mediumInput.innerHTML = '<option value="">Select Medium</option>';

                // Populate the medium dropdown
                mediums.forEach(mediumItem => {
                    const option = document.createElement('option');
                    option.value = mediumItem.medium_id;
                    option.textContent = mediumItem.medium_name;
                    mediumInput.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching mediums:', error));
    }

    // Function to fetch and populate classes
    function fetchClasses() {
        fetch('/get_SchoolClass')
            .then(response => response.json())
            .then(classes => {
                const classInput = document.getElementById('grade');
                classInput.innerHTML = '<option value="">Select Class</option>';

                // Populate the class dropdown
                classes.forEach(classItem => {
                    const option = document.createElement('option');
                    option.value = classItem.classs_id;
                    option.textContent = classItem.classs_name;
                    classInput.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching classes:', error));
    }

    // Function to fetch and populate subjects based on selected board, medium, and class
    function fetchSubjects() {
        const boardInput = document.getElementById('board');
        const mediumInput = document.getElementById('medium');
        const classInput = document.getElementById('grade');
        //const subjectInput = document.getElementById('subject'); // Subject dropdown

        // Get selected values
        const selectedBoard = boardInput.value;
        const selectedMedium = mediumInput.value;
        const selectedClass = classInput.value;

        fetch('/get_SubjectDetails', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                mediumName: selectedMedium,
                className: selectedClass,
                boardName: selectedBoard
            }),
        })
            .then(response => {
                console.log("Response Status:", response.status);
                return response.json();
            })
            .then(subject => {
                const subjectInput = document.getElementById('subject');

                // Clear previous options
                subjectInput.innerHTML = '<option value="">Select Subject</option>';

                // Iterate through the array and create option elements
                subject.forEach(subItem => {

                    const option = document.createElement('option');
                    option.value = subItem.subject_id; // Adjust based on actual keys
                    option.textContent = subItem.subject_name; // Adjust based on actual keys
                    subjectInput.appendChild(option);
                });

            })

    }


    // Function to fetch and populate topics based on selected subject
    function fetchTopics() {
        const boardInput = document.getElementById('board');
        const mediumInput = document.getElementById('medium');
        const classInput = document.getElementById('grade');
        const subjectInput = document.getElementById('subject');
        //const topicInput = document.getElementById('topic');

        const selectedBoard = boardInput.value;
        const selectedMedium = mediumInput.value;
        const selectedClass = classInput.value;
        const selectedSubject = subjectInput.value;

        // Ensure all values are selected before making the request
        if (!selectedBoard || !selectedMedium || !selectedClass || !selectedSubject) {
            return;
        }

        fetch('/get_TopicDetails', {
            method: 'POST', headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                mediumName: selectedMedium,
                className: selectedClass,
                boardName: selectedBoard,
                subjectName: selectedSubject
            }),
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(topics => {
                const topicInput = document.getElementById('lesson');

                // Clear previous options
                topicInput.innerHTML = '<option value="">Select Topic</option>';

                // Iterate through the array and create option elements
                topics.forEach(topicItem => {
                    const option = document.createElement('option');
                    option.value = topicItem.topic_id; // Adjust based on actual keys
                    option.textContent = topicItem.topic_name; // Adjust based on actual keys
                    topicInput.appendChild(option);
                });

            })
            .catch(error => {
                console.error('Error fetching topics:', error);
                const topicInput = document.getElementById('topic');
                topicInput.innerHTML = '<option value="">Error loading topics</option>';
            });
    }



    // Load boards, mediums, and classes on page load
    document.addEventListener('DOMContentLoaded', function () {
        fetchBoards();
        fetchMediums();
        fetchClasses();

        // // Add event listeners to update subjects based on selections
        // document.getElementById('board').addEventListener('change', fetchSubjects);
        // document.getElementById('medium').addEventListener('change', fetchSubjects);
        // document.getElementById('grade').addEventListener('change', fetchSubjects);

        document.getElementById('board').addEventListener('change', fetchSubjects);
        document.getElementById('medium').addEventListener('change', fetchSubjects);
        document.getElementById('grade').addEventListener('change', fetchSubjects);
        // Add event listener for subject change
        document.getElementById('subject').addEventListener('change', fetchTopics);
    });

    async function submitForm(event) {
        event.preventDefault(); // Prevent the form from submitting the traditional way

        let formData = new FormData(document.getElementById('UploadForm')); // Assuming your form has the ID 'UploadForm'

        try {
            const response = await fetch('/submit', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (response.ok) {
                // Check the hasError value from the result
                if (result.hasError === 1) {
                    // Success message
                    alert('File uploaded successfully: ' + result.message);
                } else {
                    // Error message
                    alert('Error: ' + result.message);
                }
            } else {
                // Show a generic error if the response is not OK
                alert('Error: ' + result.message);
            }
        } catch (error) {
            // Handle any network or other errors
            alert('An error occurred while submitting the form.');
            console.error('Error:', error);
        }
    }

    function askForSetNumber() {
        // Get the checkbox for sample-paper-solution
        let samplePaperCheckbox = document.getElementById("sample-paper-solution");

        if (samplePaperCheckbox.checked) {
            // Ask the user for the set number
            let setNumber = prompt("Please enter the set number:");

            if (setNumber != null && setNumber !== '') {
                // Set the hidden input value for set_number
                document.getElementById("set_number").value = setNumber;

                // Submit the form
                document.getElementById("UploadForm").submit();
            } else {
                alert("Set number is required!");
            }
        } else {
            // If the sample-paper-solution is not checked, submit the form as usual
            document.getElementById("UploadForm").submit();
        }
    }

    // Add the event listener to the submit button
    document.getElementById('submitButton').addEventListener('click', submitForm);


</script>
</body>

</html>